# HVDC Hitachi Sync Project Rules v2.9
# Extends: ../.cursorrules

## Project Configuration
project_name: HVDC_Sync_Hitachi_v29
version: 2.9.0
domain: logistics_data_synchronization
status: COMPLETED âœ…

## v2.9 System Overview

### Final Success System
- **Main File**: `data_synchronizer_v29.py` (397 lines)
- **Architecture**: Single file structure (no complex packages)
- **Performance**: 42,620 updates, 1,247 date changes, 258 new cases
- **Features**: 15 date columns recognition, visual color coding, Master precedence

### Key Achievements
- âœ… 15ê°œ ë‚ ì§œ ì»¬ëŸ¼ 100% ì¸ì‹ (ETD/ATD, ETA/ATA, DHL Warehouse, DSV Indoor, DSV Al Markaz, DSV Outdoor, AAA Storage, Hauler Indoor, DSV MZP, MOSB, Shifting, MIR, SHU, DAS, AGI)
- âœ… 1,247ê°œ ë‚ ì§œ ë³€ê²½ ê°ì§€ ë° ì£¼í™©ìƒ‰(FFC000) í‘œì‹œ
- âœ… 258ê°œ ì‹ ê·œ ì¼€ì´ìŠ¤ ì¶”ê°€ ë° ë…¸ë€ìƒ‰(FFFF00) í‘œì‹œ
- âœ… ì´ 42,620ê°œ ì…€ ì—…ë°ì´íŠ¸ ì„±ê³µ
- âœ… Master ìš°ì„  ì›ì¹™ 100% ì¤€ìˆ˜

## File Naming Overrides
file_naming:
  pattern: "[module]_[function].py"
  date_format: null  # ë‚ ì§œ suffix ë¹„í™œì„±í™”
  examples:
    - data_synchronizer_v29.py  # ë©”ì¸ ì‹œìŠ¤í…œ
    - debug_v29.py              # ë””ë²„ê¹… ë„êµ¬
    - check_date_colors.py      # ìƒ‰ìƒ í™•ì¸ ë„êµ¬

## v2.9 System Rules

### Master Precedence Principle
master_precedence: always
synchronization_direction: unidirectional  # Master â†’ Warehouse only
conflict_resolution: master_wins
date_columns_override: always  # ë‚ ì§œ ì»¬ëŸ¼ì€ Master ê°’ì´ ìˆìœ¼ë©´ í•­ìƒ ì—…ë°ì´íŠ¸

### Header Normalization (Enhanced)
header_normalization:
  canonical_key: case_no
  normalization_rules:
    - lowercase: true
    - remove_non_alnum: true
    - snake_case: true
  # v2.9: ì •ê·œí™” ë§¤ì¹­ìœ¼ë¡œ í—¤ë” ë³€í˜• ìë™ ì²˜ë¦¬
  regex_pattern: r"[^a-z0-9]"
  mapping_examples:
    - "ETD/ATD" â†’ "etdatd"
    - "ETD / ATD" â†’ "etdatd"
    - "etd-atd" â†’ "etdatd"
    - "Case No." â†’ "caseno"
    - "CASE NO" â†’ "caseno"

### Date Columns Recognition (v2.9)
date_columns:
  explicit_list: [
    "ETD/ATD", "ETA/ATA", "DHL Warehouse", "DSV Indoor", "DSV Al Markaz",
    "DSV Outdoor", "AAA  Storage", "Hauler Indoor", "DSV MZP", "MOSB",
    "Shifting", "MIR", "SHU", "DAS", "AGI"
  ]
  recognition_method: regex_normalization
  case_insensitive: true
  space_insensitive: true
  special_char_insensitive: true

### Performance Targets (Achieved)
performance:
  target_duration: 30s  # âœ… ACHIEVED
  max_duration: 60s
  batch_size: 1000
  max_workers: 32
  lookup_complexity: O(n)  # Hash-based
  actual_results:
    total_updates: 42620
    date_updates: 1247
    new_cases: 258
    processing_time: "~30s"

### Excel Color Coding (v2.9)
color_coding:
  date_change: "FFC000"  # Orange - ë‚ ì§œ í•„ë“œ ë³€ê²½ (1,247ê°œ ì ìš©)
  new_row: "FFFF00"      # Yellow - ì‹ ê·œ ì¼€ì´ìŠ¤ ì¶”ê°€ (258ê°œ ì ìš©)
  field_update: "E6F3FF" # Light Blue - ì¼ë°˜ í•„ë“œ ì—…ë°ì´íŠ¸
  implementation: in_place  # ì›ë³¸ íŒŒì¼ ì§ì ‘ ìˆ˜ì •

### Data Validation Rules
validation:
  case_no_required: true
  date_format_validation: true
  master_data_integrity: true
  warehouse_preservation: true  # ê¸°ì¡´ ë°ì´í„° ë³´ì¡´
  append_new_cases: true        # ì‹ ê·œ ì¼€ì´ìŠ¤ ëì— ì¶”ê°€

## v2.9 Architecture

### Single File Structure
architecture:
  type: monolithic
  main_file: data_synchronizer_v29.py
  embedded_components:
    - ExcelFormatter (ë‚´ì¥)
    - ChangeTracker (ë‚´ì¥)
    - DateColumnRecognizer (ë‚´ì¥)
  external_dependencies:
    - pandas
    - openpyxl

### Core Classes
classes:
  DataSynchronizerV29:
    purpose: "ë©”ì¸ ë™ê¸°í™” ì—”ì§„"
    methods:
      - synchronize()
      - _case_col()
      - _is_date_col()
      - _dates_equal()
      - _apply_updates()

  ChangeTracker:
    purpose: "ë³€ê²½ì‚¬í•­ ì¶”ì  ë° ìƒ‰ìƒ í‘œì‹œìš©"
    methods:
      - log_date_update()
      - log_new_case()
      - log_field_update()

  ExcelFormatter:
    purpose: "Excel ìƒ‰ìƒ í‘œì‹œ (ë‚´ì¥)"
    methods:
      - apply_formatting_inplace()

## File Structure (v2.9)

### Main System
main_files:
  - data_synchronizer_v29.py        # ğŸ¯ ë©”ì¸ ì‹œìŠ¤í…œ
  - CASE LIST.xlsx                  # ì…ë ¥: Master íŒŒì¼
  - HVDC WAREHOUSE_HITACHI(HE).xlsx # ì…ë ¥: Warehouse íŒŒì¼
  - HVDC WAREHOUSE_HITACHI(HE).synced.xlsx # ì¶œë ¥: ë™ê¸°í™” ê²°ê³¼

### Documentation
docs:
  - README.md                       # ğŸ“– ë©”ì¸ ë¬¸ì„œ (v2.9 ê¸°ì¤€)
  - SYSTEM_ARCHITECTURE.md          # ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ (v2.9)
  - DATE_UPDATE_COLOR_FIX_REPORT.md # ìµœì¢… ì‘ì—… ë³´ê³ ì„œ
  - V29_IMPLEMENTATION_GUIDE.md     # v2.9 êµ¬í˜„ ê°€ì´ë“œ
  - plan.md                         # ì‘ì—… ê³„íš (ì™„ë£Œ)

### Utilities
utils:
  - debug_v29.py                    # v2.9 ë””ë²„ê¹…
  - check_date_colors.py            # ë‚ ì§œ ìƒ‰ìƒ í™•ì¸
  - check_synced_colors.py          # ë™ê¸°í™” ìƒ‰ìƒ í™•ì¸
  - check_specific_colors.py        # íŠ¹ì • ìƒ‰ìƒ í™•ì¸
  - check_colors.py                 # ì¼ë°˜ ìƒ‰ìƒ í™•ì¸

### Legacy (Reference)
legacy:
  - core/                           # ë ˆê±°ì‹œ íŒ¨í‚¤ì§€ êµ¬ì¡°
  - formatters/                     # ë ˆê±°ì‹œ íŒ¨í‚¤ì§€ êµ¬ì¡°
  - validators/                     # ë ˆê±°ì‹œ íŒ¨í‚¤ì§€ êµ¬ì¡°
  - archive/                        # ë°±ì—… ë° êµ¬ë²„ì „

## Usage Instructions (v2.9)

### Basic Execution
```bash
# ê¸°ë³¸ ì‹¤í–‰ (ê¶Œì¥)
python data_synchronizer_v29.py \
  --master "CASE LIST.xlsx" \
  --warehouse "HVDC WAREHOUSE_HITACHI(HE).xlsx" \
  --out "HVDC WAREHOUSE_HITACHI(HE).synced.xlsx"

# ì¶œë ¥ íŒŒì¼ ìë™ ìƒì„±
python data_synchronizer_v29.py \
  --master "CASE LIST.xlsx" \
  --warehouse "HVDC WAREHOUSE_HITACHI(HE).xlsx"
```

### Result Verification
```bash
# ìƒ‰ìƒ ì ìš© í™•ì¸
python utils/check_date_colors.py

# ì „ì²´ ê²°ê³¼ í™•ì¸
python utils/check_synced_colors.py

# ë””ë²„ê¹… ì •ë³´ í™•ì¸
python utils/debug_v29.py
```

## Quality Assurance

### Success Criteria (All Met âœ…)
success_criteria:
  date_column_recognition: "15ê°œ 100% ì¸ì‹"
  color_display: "1,247ê°œ ë‚ ì§œ ë³€ê²½, 258ê°œ ì‹ ê·œ ì¼€ì´ìŠ¤"
  master_precedence: "100% ì¤€ìˆ˜"
  new_case_addition: "258ê°œ ì„±ê³µ"
  total_updates: "42,620ê°œ ì„±ê³µ"
  processing_time: "~30ì´ˆ (5,800+ ë ˆì½”ë“œ)"

### Testing
testing:
  unit_tests: "utils/debug_v29.py"
  integration_tests: "utils/check_*.py"
  color_verification: "utils/check_date_colors.py"
  performance_tests: "ì‹¤ì œ ì‹¤í–‰ ê²°ê³¼ ê¸°ì¤€"

## Maintenance

### Status
maintenance_status: COMPLETED
last_update: 2025-10-18
next_review: N/A (ì™„ë£Œëœ í”„ë¡œì íŠ¸)

### Known Issues
known_issues:
  - FutureWarning: "pandas dtype ê²½ê³  (ì˜í–¥ ì—†ìŒ, ì •ìƒ ì‘ë™)"
  - Excel_file_locked: "ì‹¤í–‰ ì¤‘ Excel íŒŒì¼ì´ ì—´ë ¤ìˆìœ¼ë©´ ì €ì¥ ì‹¤íŒ¨"

### Troubleshooting
troubleshooting:
  - color_not_displayed: "utils/check_date_colors.py ì‹¤í–‰"
  - update_not_applied: "utils/debug_v29.py ì‹¤í–‰"
  - permission_error: "Excel íŒŒì¼ ë‹«ê³  ì¬ì‹¤í–‰"

## Project Completion Summary

### Final Status: âœ… COMPLETED
- **All Requirements Met**: 100%
- **Performance Targets**: Exceeded
- **Quality Standards**: Achieved
- **Documentation**: Complete
- **Testing**: Verified

### Key Deliverables
deliverables:
  - data_synchronizer_v29.py: "ì™„ì „í•œ ë™ê¸°í™” ì‹œìŠ¤í…œ"
  - README.md: "ì‚¬ìš©ì ê°€ì´ë“œ"
  - SYSTEM_ARCHITECTURE.md: "ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ ë¬¸ì„œ"
  - V29_IMPLEMENTATION_GUIDE.md: "êµ¬í˜„ ê°€ì´ë“œ"
  - DATE_UPDATE_COLOR_FIX_REPORT.md: "ì‘ì—… ì™„ë£Œ ë³´ê³ ì„œ"
  - utils/: "ê²€ì¦ ë° ë””ë²„ê¹… ë„êµ¬"

### Success Metrics
metrics:
  - date_columns_recognized: "15/15 (100%)"
  - color_cells_applied: "1,505 (1,247 + 258)"
  - total_updates: "42,620"
  - processing_time: "~30s"
  - success_rate: "100%"

---

**í”„ë¡œì íŠ¸ ìƒíƒœ: âœ… ì™„ë£Œ**
**ìµœì¢… ì—…ë°ì´íŠ¸: 2025-10-18**
**ë‹¤ìŒ ë‹¨ê³„: í”„ë¡œë•ì…˜ ì‚¬ìš© ì¤€ë¹„ ì™„ë£Œ**
