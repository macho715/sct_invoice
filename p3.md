diff --git a/hitachi/hvdc_excel_reporter_final_sqm_rev (1).py b/hitachi/hvdc_excel_reporter_final_sqm_rev (1).py
index 958e688443a3d683515d765b0724f71e4b1488ff..7d95c0930d9ea2f1ae29e190a91169f0b93debe7 100644
--- a/hitachi/hvdc_excel_reporter_final_sqm_rev (1).py
+++ b/hitachi/hvdc_excel_reporter_final_sqm_rev (1).py
@@ -193,124 +193,137 @@ def validate_kpi_thresholds(stats: Dict) -> Dict:
         }

     all_pass = all(result["status"] == "PASS" for result in validation_results.values())

     logger.info(
         f"✅ 수정 버전 KPI 검증 완료: {'ALL PASS' if all_pass else 'SOME FAILED'}"
     )
     return validation_results


 class CorrectedWarehouseIOCalculator:
     """수정된 창고 입출고 계산기"""

     def __init__(self):
         """초기화"""
         self.timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")

         # 실제 데이터 경로 설정 (현재 디렉토리 기준)
         self.data_path = Path(".")  # 현재 hitachi 디렉토리
         self.hitachi_file = self.data_path / "HVDC WAREHOUSE_HITACHI(HE).xlsx"
         self.simense_file = self.data_path / "HVDC WAREHOUSE_SIMENSE(SIM).xlsx"
         self.invoice_file = self.data_path / "HVDC WAREHOUSE_INVOICE.xlsx"

         # ✅ 수정: 창고와 현장을 명확히 분리
         self.warehouse_columns = [
-            "AAA Storage",
-            "DSV Al Markaz",
+            "DHL Warehouse",
             "DSV Indoor",
-            "DSV MZP",
-            "DSV Outdoor",
+            "DSV Al Markaz",
             "Hauler Indoor",
+            "DSV Outdoor",
+            "DSV MZP",
+            "HAULER",
+            "JDN MZD",
             "MOSB",
-            "DHL Warehouse",
+            "AAA Storage",
         ]

         self.site_columns = ["AGI", "DAS", "MIR", "SHU"]

         # ✅ 수정: 위치 우선순위 (타이브레이커용)
         self.location_priority = {
             "DSV Al Markaz": 1,
             "DSV Indoor": 2,
             "DSV Outdoor": 3,
             "AAA Storage": 4,
             "Hauler Indoor": 5,
-            "DSV MZP": 6,
-            "MOSB": 7,
-            "DHL Warehouse": 8,
-            "AGI": 9,
-            "DAS": 10,
-            "MIR": 11,
-            "SHU": 12,
+            "HAULER": 6,
+            "DSV MZP": 7,
+            "JDN MZD": 8,
+            "MOSB": 9,
+            "DHL Warehouse": 10,
+            "AGI": 11,
+            "DAS": 12,
+            "MIR": 13,
+            "SHU": 14,
         }

         # 창고 우선순위 (기존 유지)
         self.warehouse_priority = [
             "DSV Al Markaz",
             "DSV Indoor",
             "DSV Outdoor",
             "DSV MZP",
             "DSV MZD",
             "AAA Storage",
             "Hauler Indoor",
+            "HAULER",
+            "JDN MZD",
             "MOSB",
+            "DHL Warehouse",
         ]

         # ✅ FIX 1: SQM 기반 창고 관리 설정 (AAA Storage 포함)
         self.warehouse_base_sqm = {
             "DSV Al Markaz": 12000,
             "DSV Indoor": 8500,
             "DSV Outdoor": 15000,
             "DSV MZP": 1000,
             "DSV MZD": 1000,
             "AAA Storage": 2000,  # ✅ AAA Storage 용량 설정
             "Hauler Indoor": 1000,
+            "HAULER": 1000,
+            "JDN MZD": 1000,
             "MOSB": 10000,
             "DHL Warehouse": 1000,
         }

         # ✅ NEW: 과금 모드 정의 (rate-based / passthrough / no-charge)
         self.billing_mode = {
             "DSV Outdoor": "rate",
             "DSV MZP": "rate",
             "DSV Indoor": "rate",
             "DSV Al Markaz": "rate",
             "AAA Storage": "passthrough",
             "Hauler Indoor": "passthrough",
+            "HAULER": "passthrough",
+            "JDN MZD": "rate",
             "DHL Warehouse": "passthrough",
             "MOSB": "no-charge",
         }

         # ✅ FIX: 계약 단가 (AED/sqm/month) — rate 모드에만 의미
         self.warehouse_sqm_rates = {
             "DSV Outdoor": 18.0,  # Rate-기반
             "DSV MZP": 33.0,  # Rate-기반
             "DSV Indoor": 47.0,  # Rate-기반
             "DSV Al Markaz": 47.0,  # Rate-기반
             # passthrough/no-charge는 단가 미사용
             "AAA Storage": 0.0,
             "Hauler Indoor": 0.0,
+            "HAULER": 0.0,
+            "JDN MZD": 33.0,
             "DHL Warehouse": 0.0,
             "MOSB": 0.0,
         }

         # Flow Code 매핑 (v3.3-flow override 정정)
         self.flow_codes = {
             0: "Pre Arrival",
             1: "Port → Site",
             2: "Port → WH → Site",
             3: "Port → WH → MOSB → Site",
             4: "Port → WH → WH → MOSB → Site",
         }

         # 데이터 저장 변수
         self.combined_data = None
         self.total_records = 0

         logger.info("🏗️ 수정된 HVDC 입고 로직 구현 및 집계 시스템 초기화 완료")
         logger.info("🏢 창고 vs 현장 분리 + 정확한 출고 타이밍 + 재고 검증 강화")

     def build_passthrough_amounts(self, invoice_df: pd.DataFrame) -> dict:
         """
         ✅ NEW: 인보이스 원본에서 (YYYY-MM, Warehouse)별 총액을 dict로 구성
         기대 컬럼: Month(YYYY-MM), Warehouse, Invoice_Amount(AED)

@@ -487,60 +500,52 @@ class CorrectedWarehouseIOCalculator:
                         print(f"   ⚠️ {warehouse}: 컬럼 추가됨 (빈 값)")
                     else:
                         non_null_count = self.combined_data[warehouse].notna().sum()
                         print(f"   ✅ {warehouse}: {non_null_count}건 데이터")

                 if missing_warehouses:
                     logger.warning(
                         f"⚠️ 누락된 창고 컬럼들이 빈 값으로 추가됨: {missing_warehouses}"
                     )

                 logger.info(f"🔗 데이터 결합 완료: {self.total_records}건")
             else:
                 raise ValueError("로드할 데이터 파일이 없습니다.")

         except Exception as e:
             logger.error(f"❌ 데이터 로드 실패: {str(e)}")
             raise

         return self.combined_data

     def _override_flow_code(self):
         """🔧 Flow Code 재계산 (v3.4-corrected: Off-by-One 버그 수정)"""
         logger.info("🔄 v3.4-corrected: Off-by-One 버그 수정 + Pre Arrival 정확 판별")

         # 창고 컬럼 (MOSB 제외, 실제 데이터 기준)
-        WH_COLS = [
-            "AAA Storage",
-            "DSV Al Markaz",
-            "DSV Indoor",
-            "DSV MZP",
-            "DSV Outdoor",
-            "Hauler Indoor",
-            "DHL Warehouse",
-        ]
-        MOSB_COLS = ["MOSB"]
+        WH_COLS = [w for w in self.warehouse_columns if w != "MOSB"]
+        MOSB_COLS = [w for w in self.warehouse_columns if w == "MOSB"]

         # ① wh handling 값은 별도 보존 (원본 유지)
         if "wh handling" in self.combined_data.columns:
             # ✅ FIX 3: 원본 데이터 우선 보존
             original_wh_handling = self.combined_data["wh handling"].copy()
             self.combined_data["wh_handling_original"] = original_wh_handling
             self.combined_data.rename(
                 columns={"wh handling": "wh_handling_legacy"}, inplace=True
             )
             logger.info(
                 "📋 기존 'wh handling' 컬럼을 'wh_handling_original'과 'wh_handling_legacy'로 보존"
             )

         # ② 0값과 빈 문자열을 NaN으로 치환 (notna() 오류 방지)
         for col in WH_COLS + MOSB_COLS:
             if col in self.combined_data.columns:
                 self.combined_data[col] = self.combined_data[col].replace(
                     {0: np.nan, "": np.nan}
                 )

         # ③ 명시적 Pre Arrival 판별
         status_col = "Status_Location"
         if status_col in self.combined_data.columns:
             is_pre_arrival = self.combined_data[status_col].str.contains(
                 "Pre Arrival", case=False, na=False
@@ -1566,71 +1571,53 @@ class HVDCExcelReporterFinal:
             "direct_result": direct_result,
             "inbound_pivot": inbound_pivot,
             "processed_data": df,
             # ✅ NEW: SQM 관련 결과 추가
             "sqm_inbound": sqm_inbound,
             "sqm_outbound": sqm_outbound,
             "sqm_cumulative_inventory": sqm_cumulative,
             "sqm_invoice_charges": sqm_charges,
             "sqm_data_quality": sqm_quality,
         }

     def create_warehouse_monthly_sheet(self, stats: Dict) -> pd.DataFrame:
         """창고_월별_입출고 시트 생성 (동일 날짜 창고간 이동 반영)"""
         logger.info("🏢 창고_월별_입출고 시트 생성 (창고간 이동 반영)")

         # 월별 기간 생성 (2023-02 ~ 2025-07)
         months = pd.date_range("2023-02", "2025-07", freq="MS")
         month_strings = [month.strftime("%Y-%m") for month in months]

         # 결과 DataFrame 초기화
         results = []

         for month_str in month_strings:
             row = [month_str]  # 첫 번째 컬럼: 입고월

-            # ✅ FIX 1: 창고 목록 (AAA Storage 포함 확인)
-            warehouses = [
-                "AAA Storage",
-                "DSV Al Markaz",
-                "DSV Indoor",
-                "DSV MZP",
-                "DSV Outdoor",
-                "Hauler Indoor",
-                "MOSB",
-                "DHL Warehouse",
-            ]
-            warehouse_display_names = [
-                "AAA Storage",
-                "DSV Al Markaz",
-                "DSV Indoor",
-                "DSV MZP",
-                "DSV Outdoor",
-                "Hauler Indoor",
-                "MOSB",
-                "DHL Warehouse",
-            ]
+            # ✅ Stage-1 정규화 순서 기반 창고 목록 사용
+            warehouses = list(self.calculator.warehouse_columns)
+            warehouse_display_names = list(self.calculator.warehouse_columns)

             inbound_values = []

             # 입고 계산 (순수 입고 + 창고간 이동 입고)
             for i, warehouse in enumerate(warehouses):
                 inbound_count = 0

                 # 1. 순수 입고 (external_arrival)
                 for item in stats["inbound_result"].get("inbound_items", []):
                     if (
                         item.get("Warehouse") == warehouse
                         and item.get("Year_Month") == month_str
                         and item.get("Inbound_Type") == "external_arrival"
                     ):
                         inbound_count += item.get("Pkg_Quantity", 1)

                 # 2. 창고간 이동 입고 (키 이름 수정)
                 for transfer in stats["inbound_result"].get("warehouse_transfers", []):
                     if (
                         transfer.get("to_warehouse") == warehouse
                         and transfer.get("Year_Month") == month_str
                     ):
                         inbound_count += transfer.get("pkg_quantity", 1)

                 inbound_values.append(inbound_count)
@@ -1644,58 +1631,58 @@ class HVDCExcelReporterFinal:
                 # 창고간 이동 출고
                 for transfer in stats["inbound_result"].get("warehouse_transfers", []):
                     if (
                         transfer.get("from_warehouse") == warehouse
                         and transfer.get("Year_Month") == month_str
                     ):
                         outbound_count += transfer.get("pkg_quantity", 1)

                 # 창고→현장 출고 (키 이름 수정)
                 for item in stats["outbound_result"].get("outbound_items", []):
                     if (
                         item.get("From_Location") == warehouse
                         and item.get("Year_Month") == month_str
                     ):
                         outbound_count += item.get("Pkg_Quantity", 1)

                 outbound_values.append(outbound_count)
                 row.append(outbound_count)

             # 누계 열 추가
             row.append(sum(inbound_values))  # 누계_입고
             row.append(sum(outbound_values))  # 누계_출고

             results.append(row)

-        # 컬럼 생성 (19열)
+        # 컬럼 생성 (입고월 + 입고/출고 × 창고수 + 누계 2열)
         columns = ["입고월"]

-        # 입고 8개 창고
+        # 입고 N개 창고
         for warehouse in warehouse_display_names:
             columns.append(f"입고_{warehouse}")

-        # 출고 8개 창고
+        # 출고 N개 창고
         for warehouse in warehouse_display_names:
             columns.append(f"출고_{warehouse}")

         # 누계 열
         columns.append("누계_입고")
         columns.append("누계_출고")

         # DataFrame 생성
         warehouse_monthly = pd.DataFrame(results, columns=columns)

         # 총합계 행 추가
         total_row = ["Total"]
         for col in warehouse_monthly.columns[1:]:
             total_row.append(warehouse_monthly[col].sum())
         warehouse_monthly.loc[len(warehouse_monthly)] = total_row

         logger.info(
             f"✅ 창고_월별_입출고 시트 완료 (창고간 이동 반영): {warehouse_monthly.shape}"
         )
         return warehouse_monthly

     def create_site_monthly_sheet(self, stats: Dict) -> pd.DataFrame:
         """현장_월별_입고재고 시트 생성 (Multi-Level Header 9열) - 중복 없는 실제 현장 입고만 집계"""
         logger.info("🏗️ 현장_월별_입고재고 시트 생성 (9열, 중복 없는 집계)")

@@ -1830,53 +1817,51 @@ class HVDCExcelReporterFinal:
             .sum()
             .rename(columns={"Pkg": "value"})
         )
         nodes = sorted(set(g["From"]).union(set(g["To"])))
         node_index = {n: i for i, n in enumerate(nodes)}
         g["source"] = g["From"].map(node_index)
         g["target"] = g["To"].map(node_index)
         return g[["source", "target", "value"]], nodes

     def _ftd__kpis(self, df: pd.DataFrame, segments: pd.DataFrame) -> dict:
         """KPI: MOSB 통과율, 직송 비율(FLOW_CODE=1), WH 평균 체류(Port/WH 구간)"""
         if segments.empty:
             mosb_rate = 0.0
             avg_wh_dwell = 0.0
         else:
             cases_with_mosb = (
                 segments.assign(
                     has_mosb=lambda d: (d["From"].eq("MOSB") | d["To"].eq("MOSB"))
                 )
                 .groupby("Case")["has_mosb"]
                 .max()
                 .mean()
             )
             mosb_rate = float(cases_with_mosb) * 100.0

-            wh_nodes = set(
-                ["Port", "AAA Storage", "DSV Indoor", "DSV Al Markaz", "DSV Outdoor"]
-            )
+            wh_nodes = set(["Port"] + list(self.calculator.warehouse_columns))
             wh_dwell = segments[segments["From"].isin(wh_nodes)]["Dwell_Days"]
             avg_wh_dwell = float(wh_dwell.mean()) if not wh_dwell.empty else 0.0

         if "FLOW_CODE" in df.columns:
             total_cases = df.shape[0]
             direct_cases = int((df["FLOW_CODE"] == 1).sum())
             direct_rate = (direct_cases / total_cases * 100.0) if total_cases else 0.0
         else:
             direct_rate = 0.0

         return {
             "MOSB_Pass_Rate_%": round(mosb_rate, 2),
             "Direct_Flow_Rate_%": round(direct_rate, 2),
             "Avg_WH_Dwell_Days": round(avg_wh_dwell, 2),
         }

     def create_flow_traceability_frames(self, stats: dict) -> dict:
         """Flow Traceability (Sankey + Timeline + KPI) 프레임 생성.
         출력:
           - sankey_links: source,target,value
           - sankey_nodes: [label...]
           - timeline_segments: Case,From,To,Start,End,Dwell_Days,Pkg
           - kpis: dict
         """
         df = stats.get("processed_data")
@@ -1911,70 +1896,60 @@ class HVDCExcelReporterFinal:
         links.to_excel(writer, sheet_name="Flow_Sankey_Links", index=False)

         timeline = frames.get("timeline_segments", pd.DataFrame())
         if timeline is None:
             timeline = pd.DataFrame()
         if not timeline.empty:
             timeline = timeline.copy()
             for col in ["Start", "End"]:
                 if col in timeline.columns:
                     timeline[col] = pd.to_datetime(timeline[col]).dt.strftime(
                         "%Y-%m-%d %H:%M:%S"
                     )
         timeline.to_excel(writer, sheet_name="Flow_Timeline", index=False)

         kpis = frames.get("kpis", {})
         if kpis:
             pd.DataFrame([kpis]).to_excel(writer, sheet_name="Flow_KPI", index=False)

     # === END MACHO PATCH: Flow Traceability Dashboard ===

     def create_multi_level_headers(
         self, df: pd.DataFrame, sheet_type: str
     ) -> pd.DataFrame:
         """Multi-Level Header 생성 (가이드 표준)"""
         if sheet_type == "warehouse":
-            # 창고 Multi-Level Header: 19열 (Location + 입고8 + 출고8)
+            warehouses = list(self.calculator.warehouse_columns)
+            # 창고 Multi-Level Header: 입고월 + (입고/출고 × 창고수)
             level_0 = ["입고월"]  # 첫 번째 컬럼
             level_1 = [""]

-            # ✅ FIX 1: 입고 8개 창고 (AAA Storage 포함)
-            warehouses = [
-                "AAA Storage",
-                "DSV Al Markaz",
-                "DSV Indoor",
-                "DSV MZP",
-                "DSV Outdoor",
-                "Hauler Indoor",
-                "MOSB",
-                "DHL Warehouse",
-            ]
             for warehouse in warehouses:
                 level_0.append("입고")
                 level_1.append(warehouse)

-            # 출고 8개 창고 (동일 순서)
+            # 출고 N개 창고 (동일 순서)
             for warehouse in warehouses:
                 level_0.append("출고")
                 level_1.append(warehouse)

             multi_columns = pd.MultiIndex.from_arrays(
                 [level_0, level_1], names=["Type", "Location"]
             )

         elif sheet_type == "site":
             # 현장 Multi-Level Header: 9열 (Location + 입고4 + 재고4)
             level_0 = ["입고월"]  # 첫 번째 컬럼
             level_1 = [""]

             # 입고 4개 현장 (가이드 순서)
             sites = ["AGI", "DAS", "MIR", "SHU"]
             for site in sites:
                 level_0.append("입고")
                 level_1.append(site)

             # 재고 4개 현장 (동일 순서)
             for site in sites:
                 level_0.append("재고")
                 level_1.append(site)

             multi_columns = pd.MultiIndex.from_arrays(
@@ -2584,61 +2559,53 @@ def test_same_date_warehouse_transfer():

     print(
         "[SUCCESS] 모든 테스트 통과! AAA Storage 포함 동일 날짜 창고간 이동 로직 검증 완료"
     )
     return True


 def validate_inventory_logic(df: pd.DataFrame) -> bool:
     """✅ Status_Location 기반 재고 로직 검증"""
     print("🔍 Status_Location 기반 재고 로직 검증 시작...")

     if "Status_Location" not in df.columns:
         print("❌ Status_Location 컬럼이 없습니다.")
         return False

     # Status_Location 분포 확인
     status_distribution = df["Status_Location"].value_counts()
     print(f"📊 Status_Location 분포:")
     for location, count in status_distribution.head(10).items():
         print(f"   {location}: {count:,}건")

     # 창고 vs 현장 분리 확인
     warehouse_count = 0
     site_count = 0

-    warehouse_columns = [
-        "AAA Storage",
-        "DSV Al Markaz",
-        "DSV Indoor",
-        "DSV MZP",
-        "DSV Outdoor",
-        "Hauler Indoor",
-        "MOSB",
-        "DHL Warehouse",
-    ]
-    site_columns = ["AGI", "DAS", "MIR", "SHU"]
+    calculator = CorrectedWarehouseIOCalculator()
+    warehouse_columns = list(calculator.warehouse_columns)
+    site_columns = list(calculator.site_columns)

     for location in status_distribution.index:
         if location in warehouse_columns:
             warehouse_count += status_distribution[location]
         elif location in site_columns:
             site_count += status_distribution[location]

     print(f"🏢 창고 재고: {warehouse_count:,}건")
     print(f"🏗️ 현장 재고: {site_count:,}건")
     print(f"📦 총 재고: {warehouse_count + site_count:,}건")

     return True


 def validate_patch_effectiveness():
     """✅ 패치 효과 검증 함수 추가"""
     print("[VALIDATION] 패치 효과 검증 시작...")

     try:
         # 시스템 초기화
         reporter = HVDCExcelReporterFinal()

         # 종합 통계 계산
         stats = reporter.calculate_warehouse_statistics()

diff --git a/hitachi/tests/test_stage1_warehouse_alignment.py b/hitachi/tests/test_stage1_warehouse_alignment.py
new file mode 100644
index 0000000000000000000000000000000000000000..29237f01921274c79d7817412f10790090ca87d9
--- /dev/null
+++ b/hitachi/tests/test_stage1_warehouse_alignment.py
@@ -0,0 +1,63 @@
+"""Stage-1 창고 헤더 정규화 테스트/Stage-1 warehouse header compatibility."""
+
+from __future__ import annotations
+
+import importlib.util
+from pathlib import Path
+from types import ModuleType
+
+import pandas as pd
+
+
+def _load_reporter_module() -> ModuleType:
+    """Stage-1 모듈에서 리포터 로드/Load reporter from Stage-1 module."""
+
+    module_dir = Path(__file__).parent.parent
+    module_path = module_dir / "hvdc_excel_reporter_final_sqm_rev (1).py"
+    spec = importlib.util.spec_from_file_location(
+        "hvdc_excel_reporter_final_sqm_rev", module_path
+    )
+    module = importlib.util.module_from_spec(spec)
+    if spec.loader is None:
+        raise RuntimeError("Unable to load hvdc_excel_reporter module")
+    spec.loader.exec_module(module)
+    return module
+
+
+def test_stage1_warehouse_columns_support() -> None:
+    """HAULER·JDN MZD 입출고·SQM 반영/Ensure HAULER·JDN MZD appear in IO & SQM."""
+
+    module = _load_reporter_module()
+    calculator = module.CorrectedWarehouseIOCalculator()
+
+    df = pd.DataFrame(
+        [
+            {
+                "Pkg": 1,
+                "HAULER": pd.Timestamp("2024-05-01"),
+                "MIR": pd.Timestamp("2024-05-02"),
+            },
+            {
+                "Pkg": 2,
+                "JDN MZD": pd.Timestamp("2024-06-01"),
+                "SHU": pd.Timestamp("2024-06-03"),
+            },
+        ]
+    )
+
+    inbound = calculator.calculate_warehouse_inbound_corrected(df)
+    outbound = calculator.calculate_warehouse_outbound_corrected(df)
+    sqm_inbound = calculator.calculate_monthly_sqm_inbound(df)
+    sqm_outbound = calculator.calculate_monthly_sqm_outbound(df)
+
+    assert inbound["by_warehouse"]["HAULER"] == 1
+    assert inbound["by_warehouse"]["JDN MZD"] == 2
+
+    assert outbound["by_warehouse"]["HAULER"] == 1
+    assert outbound["by_warehouse"]["JDN MZD"] == 2
+
+    assert "HAULER" in sqm_inbound["2024-05"]
+    assert "JDN MZD" in sqm_inbound["2024-06"]
+
+    assert "HAULER" in sqm_outbound["2024-05"]
+    assert "JDN MZD" in sqm_outbound["2024-06"]
